<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–®è©æ‹¼å¯«éŠæˆ² - YLE Starters</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'PingFang TC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        .subtitle {
            text-align: center;
            color: rgba(255,255,255,0.9);
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        /* ç»Ÿè®¡æ  */
        .stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 0.95em;
        }

        .stat-box span {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* æ§åˆ¶åŒº */
        .controls {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .control-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            text-align: center;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .btn {
            background: #f1f3f4;
            border: 2px solid transparent;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #e8f0fe;
        }

        .btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .btn.green {
            background: #51cf66;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
        }

        .btn.green:hover {
            background: #40c057;
            transform: translateY(-2px);
        }

        .btn.blue {
            background: #339af0;
            color: white;
            border: none;
        }

        .btn.blue:hover {
            background: #228be6;
        }

        /* æ¸¸æˆåŒº */
        .game-area {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* ç¬¬ä¸€æ­¥ï¼šé€‰ä¸­æ–‡ */
        .step-indicator {
            text-align: center;
            color: #868e96;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .step-indicator .step {
            display: inline-block;
            padding: 3px 12px;
            border-radius: 10px;
            margin: 0 5px;
        }

        .step-indicator .step.active {
            background: #667eea;
            color: white;
        }

        .step-indicator .step.done {
            background: #51cf66;
            color: white;
        }

        /* å•è¯æ˜¾ç¤º */
        .word-display {
            text-align: center;
            margin-bottom: 25px;
        }

        .chinese-word {
            font-size: 3em;
            color: #333;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .word-hint {
            color: #868e96;
            font-size: 0.9em;
        }

        /* æ‹¼å†™åŒºåŸŸ */
        .spelling-area {
            text-align: center;
            margin-bottom: 25px;
        }

        .letter-boxes {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .letter-box {
            width: 50px;
            height: 55px;
            border: 3px solid #dee2e6;
            border-radius: 10px;
            font-size: 1.8em;
            text-align: center;
            text-transform: lowercase;
            font-weight: bold;
            color: #333;
            background: white;
            transition: all 0.2s;
        }

        .letter-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .letter-box.hint {
            background: #fff3bf;
            border-color: #fab005;
            color: #333;
        }

        .letter-box.correct {
            background: #d3f9d8;
            border-color: #51cf66;
        }

        .letter-box.wrong {
            background: #ffe3e3;
            border-color: #ff6b6b;
        }

        .letter-box:disabled {
            background: #f8f9fa;
        }

        /* é€‰æ‹©ä¸­æ–‡æ„æ€ */
        .meaning-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .meaning-btn {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background: white;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .meaning-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .meaning-btn.selected {
            border-color: #667eea;
            background: #e8f0fe;
        }

        .meaning-btn.correct {
            border-color: #51cf66;
            background: #d3f9d8;
        }

        .meaning-btn.wrong {
            border-color: #ff6b6b;
            background: #ffe3e3;
        }

        /* æŒ‰é’® */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        /* ç»“æœæ¶ˆæ¯ */
        .result-message {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 1.1em;
            display: none;
        }

        .result-message.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .result-message.success {
            background: #d3f9d8;
            color: #2b8a3e;
        }

        .result-message.error {
            background: #ffe3e3;
            color: #c92a2a;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #51cf66, #40c057);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        /* å®Œæˆç”»é¢ */
        .completion-screen {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .completion-screen.show {
            display: block;
        }

        .completion-screen h2 {
            color: #51cf66;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .completion-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
        }

        .completion-stat {
            text-align: center;
        }

        .completion-stat .value {
            font-size: 2.5em;
            color: #667eea;
            font-weight: bold;
        }

        .completion-stat .label {
            color: #868e96;
            font-size: 0.9em;
        }

        /* é”®ç›˜æç¤º */
        .keyboard-hint {
            text-align: center;
            color: #868e96;
            font-size: 0.8em;
            margin-top: 10px;
        }

        @media (max-width: 500px) {
            .letter-box {
                width: 40px;
                height: 45px;
                font-size: 1.4em;
            }
            .chinese-word {
                font-size: 2.2em;
            }
            .meaning-options {
                grid-template-columns: 1fr;
            }
            .meaning-btn {
                font-size: 1.1em;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¤ å–®è©æ‹¼å¯«éŠæˆ²</h1>
        <p class="subtitle">YLE Starters Â· çœ‹ä¸­æ–‡æ‹¼è‹±æ–‡</p>

        <div class="stats">
            <div class="stat-box">âœ… æ­£ç¢º: <span id="correct">0</span></div>
            <div class="stat-box">âŒ éŒ¯èª¤: <span id="wrong">0</span></div>
            <div class="stat-box">ğŸ“Š é¡Œç›®: <span id="current">0</span>/<span id="total">0</span></div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="controls">
            <div class="control-row">
                <div style="width: 100%;">
                    <span class="control-label">ğŸ“š é¸æ“‡é¡åˆ¥</span>
                    <div class="control-row" id="categoryBtns"></div>
                </div>
            </div>
            <div class="control-row">
                <div>
                    <span class="control-label">ğŸ¯ é›£åº¦</span>
                    <div class="control-row">
                        <button class="btn active" onclick="setDifficulty('easy', this)">ç°¡å–®ï¼ˆæç¤ºå­—æ¯ï¼‰</button>
                        <button class="btn" onclick="setDifficulty('hard', this)">å›°é›£ï¼ˆå…¨ç©ºç™½ï¼‰</button>
                    </div>
                </div>
                <div>
                    <span class="control-label">ğŸ”¢ é¡Œç›®æ•¸é‡</span>
                    <div class="control-row">
                        <button class="btn" onclick="setCount(5, this)">5é¡Œ</button>
                        <button class="btn active" onclick="setCount(10, this)">10é¡Œ</button>
                        <button class="btn" onclick="setCount(20, this)">20é¡Œ</button>
                    </div>
                </div>
            </div>
            <div class="control-row">
                <button class="btn green" onclick="startGame()">ğŸš€ é–‹å§‹éŠæˆ²</button>
                <a href="index.html" class="btn" style="text-decoration:none;">ğŸ  è¿”å›é¦–é </a>
            </div>
        </div>

        <div class="game-area" id="gameArea" style="display: none;">
            <div class="step-indicator">
                <span class="step active" id="step1">Step 1: é¸æ„æ€</span>
                <span class="step" id="step2">Step 2: æ‹¼å–®è©</span>
            </div>

            <!-- Step 1: é€‰æ‹©ä¸­æ–‡æ„æ€ -->
            <div id="step1Area">
                <div class="word-display">
                    <div class="chinese-word" id="displayWord">???</div>
                    <div class="word-hint">è«‹é¸æ“‡æ­£ç¢ºçš„ä¸­æ–‡æ„æ€</div>
                </div>
                <div class="meaning-options" id="meaningOptions"></div>
            </div>

            <!-- Step 2: æ‹¼å†™ -->
            <div id="step2Area" style="display: none;">
                <div class="word-display">
                    <div class="chinese-word" id="chineseHint">è˜‹æœ</div>
                    <div class="word-hint">è«‹æ‹¼å‡ºè‹±æ–‡å–®è©</div>
                </div>
                <div class="spelling-area">
                    <div class="letter-boxes" id="letterBoxes"></div>
                    <div class="keyboard-hint">ä½¿ç”¨éµç›¤è¼¸å…¥å­—æ¯ï¼ŒæŒ‰ Enter æäº¤</div>
                </div>
                <div class="action-buttons">
                    <button class="btn green" onclick="checkAnswer()">âœ“ ç¢ºèª</button>
                    <button class="btn blue" onclick="skipWord()">è·³é â†’</button>
                </div>
            </div>

            <div class="result-message" id="resultMessage"></div>
        </div>

        <div class="game-area completion-screen" id="completionScreen">
            <h2>ğŸ‰ å®Œæˆå•¦ï¼</h2>
            <div class="completion-stats">
                <div class="completion-stat">
                    <div class="value" id="finalCorrect">0</div>
                    <div class="label">æ­£ç¢º</div>
                </div>
                <div class="completion-stat">
                    <div class="value" id="finalWrong">0</div>
                    <div class="label">éŒ¯èª¤</div>
                </div>
                <div class="completion-stat">
                    <div class="value" id="finalAccuracy">0%</div>
                    <div class="label">æ­£ç¢ºç‡</div>
                </div>
            </div>
            <div style="display:flex;justify-content:center;gap:10px;flex-wrap:wrap;">
                <button class="btn green" onclick="startGame()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
                <a href="index.html" class="btn" style="background:#868e96;color:white;text-decoration:none;">ğŸ  è¿”å›é¦–é </a>
            </div>
        </div>
    </div>

    <script>
        // å•è¯åº“ï¼ˆä¸ç¿»ç‰Œæ¸¸æˆå…±ç”¨ï¼‰
        const wordBank = {
            "å‹•ç‰©": [
                { en: "animal", zh: "å‹•ç‰©" }, { en: "bear", zh: "ç†Š" }, { en: "bee", zh: "èœœèœ‚" },
                { en: "bird", zh: "é³¥" }, { en: "cat", zh: "è²“" }, { en: "chicken", zh: "é›" },
                { en: "cow", zh: "ç‰›" }, { en: "crocodile", zh: "é±·é­š" }, { en: "dog", zh: "ç‹—" },
                { en: "duck", zh: "é´¨å­" }, { en: "elephant", zh: "å¤§è±¡" }, { en: "fish", zh: "é­š" },
                { en: "frog", zh: "é’è›™" }, { en: "giraffe", zh: "é•·é ¸é¹¿" }, { en: "goat", zh: "å±±ç¾Š" },
                { en: "hippo", zh: "æ²³é¦¬" }, { en: "horse", zh: "é¦¬" }, { en: "monkey", zh: "çŒ´å­" },
                { en: "mouse", zh: "è€é¼ " }, { en: "snake", zh: "è›‡" }, { en: "tiger", zh: "è€è™" },
                { en: "zebra", zh: "æ–‘é¦¬" }
            ],
            "é£Ÿç‰©": [
                { en: "bread", zh: "éºµåŒ…" }, { en: "burger", zh: "æ¼¢å ¡" }, { en: "cake", zh: "è›‹ç³•" },
                { en: "candy", zh: "ç³–æœ" }, { en: "chocolate", zh: "æœ±å¤åŠ›" }, { en: "egg", zh: "é›è›‹" },
                { en: "ice cream", zh: "é›ªç³•" }, { en: "meat", zh: "è‚‰" }, { en: "pizza", zh: "æŠ«è–©" },
                { en: "rice", zh: "ç±³é£¯" }, { en: "sausage", zh: "é¦™è…¸" }, { en: "sandwich", zh: "ä¸‰æ–‡æ²»" }
            ],
            "æ°´æœ": [
                { en: "apple", zh: "è˜‹æœ" }, { en: "banana", zh: "é¦™è•‰" }, { en: "grape", zh: "è‘¡è„" },
                { en: "lemon", zh: "æª¸æª¬" }, { en: "mango", zh: "èŠ’æœ" }, { en: "orange", zh: "æ©™" },
                { en: "pear", zh: "æ¢¨" }, { en: "pineapple", zh: "è è˜¿" }
            ],
            "èº«é«”": [
                { en: "arm", zh: "æ‰‹è‡‚" }, { en: "ear", zh: "è€³æœµ" }, { en: "eye", zh: "çœ¼ç›" },
                { en: "face", zh: "è‡‰" }, { en: "hair", zh: "é ­é«®" }, { en: "hand", zh: "æ‰‹" },
                { en: "head", zh: "é ­" }, { en: "leg", zh: "è…¿" }, { en: "mouth", zh: "å˜´å·´" },
                { en: "nose", zh: "é¼»å­" }
            ],
            "å®¶åº­": [
                { en: "baby", zh: "å¬°å…’" }, { en: "boy", zh: "ç”·å­©" }, { en: "brother", zh: "å…„å¼Ÿ" },
                { en: "family", zh: "å®¶åº­" }, { en: "father", zh: "çˆ¶è¦ª" }, { en: "friend", zh: "æœ‹å‹" },
                { en: "girl", zh: "å¥³å­©" }, { en: "mother", zh: "æ¯è¦ª" }, { en: "sister", zh: "å§å¦¹" }
            ],
            "é¡è‰²": [
                { en: "black", zh: "é»‘è‰²" }, { en: "blue", zh: "è—è‰²" }, { en: "brown", zh: "æ£•è‰²" },
                { en: "green", zh: "ç¶ è‰²" }, { en: "orange", zh: "æ©™è‰²" }, { en: "pink", zh: "ç²‰è‰²" },
                { en: "purple", zh: "ç´«è‰²" }, { en: "red", zh: "ç´…è‰²" }, { en: "white", zh: "ç™½è‰²" },
                { en: "yellow", zh: "é»ƒè‰²" }
            ],
            "æ•¸å­—": [
                { en: "one", zh: "ä¸€" }, { en: "two", zh: "äºŒ" }, { en: "three", zh: "ä¸‰" },
                { en: "four", zh: "å››" }, { en: "five", zh: "äº”" }, { en: "six", zh: "å…­" },
                { en: "seven", zh: "ä¸ƒ" }, { en: "eight", zh: "å…«" }, { en: "nine", zh: "ä¹" },
                { en: "ten", zh: "å" }
            ],
            "å­¸æ ¡": [
                { en: "book", zh: "æ›¸" }, { en: "classroom", zh: "èª²å®¤" }, { en: "desk", zh: "æ›¸æ¡Œ" },
                { en: "pen", zh: "é‹¼ç­†" }, { en: "pencil", zh: "é‰›ç­†" }, { en: "ruler", zh: "å°ºå­" },
                { en: "school", zh: "å­¸æ ¡" }, { en: "teacher", zh: "è€å¸«" }
            ],
            "å®¶å±…": [
                { en: "bed", zh: "åºŠ" }, { en: "chair", zh: "æ¤…å­" }, { en: "clock", zh: "æ™‚é˜" },
                { en: "door", zh: "é–€" }, { en: "house", zh: "æˆ¿å­" }, { en: "room", zh: "æˆ¿é–“" },
                { en: "table", zh: "æ¡Œå­" }, { en: "window", zh: "çª—æˆ¶" }
            ],
            "äº¤é€š": [
                { en: "bike", zh: "å–®è»Š" }, { en: "boat", zh: "èˆ¹" }, { en: "bus", zh: "å·´å£«" },
                { en: "car", zh: "æ±½è»Š" }, { en: "plane", zh: "é£›æ©Ÿ" }, { en: "train", zh: "ç«è»Š" }
            ],
            "è‡ªç„¶": [
                { en: "beach", zh: "æµ·ç˜" }, { en: "flower", zh: "èŠ±" }, { en: "garden", zh: "èŠ±åœ’" },
                { en: "moon", zh: "æœˆäº®" }, { en: "park", zh: "å…¬åœ’" }, { en: "star", zh: "æ˜Ÿæ˜Ÿ" },
                { en: "sun", zh: "å¤ªé™½" }, { en: "tree", zh: "æ¨¹" }, { en: "water", zh: "æ°´" }
            ],
            "å‹•ä½œ": [
                { en: "catch", zh: "æ¥" }, { en: "clap", zh: "æ‹æ‰‹" }, { en: "dance", zh: "è·³èˆ" },
                { en: "draw", zh: "ç•«ç•«" }, { en: "drink", zh: "å–" }, { en: "eat", zh: "åƒ" },
                { en: "fly", zh: "é£›" }, { en: "jump", zh: "è·³" }, { en: "kick", zh: "è¸¢" },
                { en: "read", zh: "è®€" }, { en: "run", zh: "è·‘" }, { en: "sing", zh: "å”±" },
                { en: "sit", zh: "å" }, { en: "sleep", zh: "ç¡è¦º" }, { en: "stand", zh: "ç«™" },
                { en: "swim", zh: "æ¸¸æ³³" }, { en: "walk", zh: "è¡Œ" }, { en: "write", zh: "å¯«" }
            ]
        };

        // æ¸¸æˆçŠ¶æ€
        let selectedCategory = null;
        let difficulty = 'easy';
        let questionCount = 10;
        let gameWords = [];
        let currentWordIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let currentWord = null;
        let selectedMeaning = null;
        let gameActive = false;
        let attemptCount = 0;
        const maxAttempts = 3;

        // åˆå§‹åŒ–åˆ†ç±»æŒ‰é’®
        function initCategoryBtns() {
            const container = document.getElementById('categoryBtns');
            container.innerHTML = '';
            
            const allBtn = document.createElement('button');
            allBtn.className = 'btn active';
            allBtn.textContent = 'å…¨éƒ¨';
            allBtn.onclick = (e) => selectCategory(null, e.target);
            container.appendChild(allBtn);
            
            Object.keys(wordBank).forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = cat;
                btn.onclick = (e) => selectCategory(cat, e.target);
                container.appendChild(btn);
            });
        }

        function selectCategory(cat, target) {
            selectedCategory = cat;
            document.querySelectorAll('#categoryBtns .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            target.classList.add('active');
        }

        function setDifficulty(level, target) {
            difficulty = level;
            document.querySelectorAll('.controls .btn').forEach(btn => {
                if (btn.textContent.includes('ç°¡å–®') || btn.textContent.includes('å›°é›£')) {
                    btn.classList.remove('active');
                }
            });
            target.classList.add('active');
        }

        function setCount(count, target) {
            questionCount = count;
            document.querySelectorAll('.controls .btn').forEach(btn => {
                if (btn.textContent.match(/^\d+é¡Œ$/)) {
                    btn.classList.remove('active');
                    if (btn.textContent === count + 'é¡Œ') {
                        btn.classList.add('active');
                    }
                }
            });
            target.classList.add('active');
        }

        function shuffle(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getWords() {
            if (selectedCategory) {
                return [...wordBank[selectedCategory]];
            }
            let all = [];
            Object.values(wordBank).forEach(arr => all = all.concat(arr));
            return all;
        }

        function startGame() {
            // é‡ç½®çŠ¶æ€
            currentWordIndex = 0;
            correctCount = 0;
            wrongCount = 0;
            gameActive = true;
            
            // é€‰æ‹©å•è¯
            const allWords = shuffle(getWords());
            const uniqueWords = [];
            const seen = new Set();
            for (const w of allWords) {
                if (!seen.has(w.en)) {
                    seen.add(w.en);
                    uniqueWords.push(w);
                }
                if (uniqueWords.length >= questionCount) break;
            }
            gameWords = uniqueWords;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('correct').textContent = '0';
            document.getElementById('wrong').textContent = '0';
            document.getElementById('current').textContent = '0';
            document.getElementById('total').textContent = gameWords.length;
            document.getElementById('progressFill').style.width = '0%';
            
            // æ˜¾ç¤ºæ¸¸æˆåŒº
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('completionScreen').classList.remove('show');
            document.getElementById('resultMessage').classList.remove('show');
            
            // å¼€å§‹ç¬¬ä¸€é¢˜
            nextWord();
        }

        function nextWord() {
            if (currentWordIndex >= gameWords.length) {
                showCompletion();
                return;
            }
            
            currentWord = gameWords[currentWordIndex];
            selectedMeaning = null;
            attemptCount = 0;
            
            // æ›´æ–°è¿›åº¦
            document.getElementById('current').textContent = currentWordIndex + 1;
            document.getElementById('progressFill').style.width = (currentWordIndex / gameWords.length * 100) + '%';
            
            // é‡ç½®æ­¥éª¤æŒ‡ç¤º
            document.getElementById('step1').className = 'step active';
            document.getElementById('step2').className = 'step';
            
            // æ˜¾ç¤º Step 1
            document.getElementById('step1Area').style.display = 'block';
            document.getElementById('step2Area').style.display = 'none';
            document.getElementById('resultMessage').classList.remove('show');
            
            // æ¢å¤æŒ‰é’®
            const actionArea = document.querySelector('.action-buttons');
            actionArea.innerHTML = `
                <button class="btn green" onclick="checkAnswer()">âœ“ ç¢ºèª</button>
                <button class="btn blue" onclick="skipWord()">è·³é â†’</button>
            `;
            
            // æ˜¾ç¤ºè‹±æ–‡å•è¯
            document.getElementById('displayWord').textContent = currentWord.en;
            
            // ç”Ÿæˆé€‰é¡¹
            generateMeaningOptions();
        }

        function generateMeaningOptions() {
            const correctAnswer = currentWord.zh;
            
            // è·å–å…¶ä»–éšæœºé€‰é¡¹
            let allMeanings = [];
            Object.values(wordBank).forEach(arr => {
                allMeanings = allMeanings.concat(arr.map(w => w.zh));
            });
            allMeanings = allMeanings.filter(m => m !== correctAnswer);
            allMeanings = shuffle(allMeanings).slice(0, 3);
            
            // æ·»åŠ æ­£ç¡®ç­”æ¡ˆ
            const options = shuffle([correctAnswer, ...allMeanings]);
            
            const container = document.getElementById('meaningOptions');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'meaning-btn';
                btn.textContent = opt;
                btn.onclick = () => selectMeaning(opt, btn);
                container.appendChild(btn);
            });
        }

        function selectMeaning(meaning, btn) {
            selectedMeaning = meaning;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.meaning-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            // æ£€æŸ¥æ˜¯å¦æ­£ç¡®
            if (meaning === currentWord.zh) {
                btn.classList.add('correct');
                // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€æ­¥
                setTimeout(() => {
                    showStep2();
                }, 500);
            } else {
                btn.classList.add('wrong');
                // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                document.querySelectorAll('.meaning-btn').forEach(b => {
                    if (b.textContent === currentWord.zh) {
                        b.classList.add('correct');
                    }
                });
                wrongCount++;
                document.getElementById('wrong').textContent = wrongCount;
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                showMessage('é¸éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š' + currentWord.zh, 'error');
                
                // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€æ­¥
                setTimeout(() => {
                    showStep2();
                }, 1500);
            }
        }

        function showStep2() {
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤º
            document.getElementById('step1').className = 'step done';
            document.getElementById('step2').className = 'step active';
            
            // åˆ‡æ¢æ˜¾ç¤º
            document.getElementById('step1Area').style.display = 'none';
            document.getElementById('step2Area').style.display = 'block';
            document.getElementById('resultMessage').classList.remove('show');
            
            // æ˜¾ç¤ºä¸­æ–‡æç¤º
            document.getElementById('chineseHint').textContent = currentWord.zh;
            
            // ç”Ÿæˆå­—æ¯æ¡†
            generateLetterBoxes();
        }

        function generateLetterBoxes() {
            const word = currentWord.en;
            const container = document.getElementById('letterBoxes');
            container.innerHTML = '';
            
            // è®¡ç®—å“ªäº›ä½ç½®éœ€è¦æç¤º
            const hintIndices = [];
            if (difficulty === 'easy') {
                // ç®€å•æ¨¡å¼ï¼šæç¤ºéƒ¨åˆ†å­—æ¯
                const hintCount = Math.ceil(word.length / 3);
                while (hintIndices.length < hintCount) {
                    const idx = Math.floor(Math.random() * word.length);
                    if (!hintIndices.includes(idx) && word[idx] !== ' ') {
                        hintIndices.push(idx);
                    }
                }
            }
            
            for (let i = 0; i < word.length; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'letter-box';
                input.maxLength = 1;
                input.dataset.index = i;
                
                if (word[i] === ' ') {
                    input.value = ' ';
                    input.disabled = true;
                    input.style.background = '#e9ecef';
                } else if (hintIndices.includes(i)) {
                    input.value = word[i];
                    input.classList.add('hint');
                    input.disabled = true;
                }
                
                input.addEventListener('input', handleInput);
                input.addEventListener('keydown', handleKeydown);
                container.appendChild(input);
            }
            
            // èšç„¦ç¬¬ä¸€ä¸ªç©ºç™½è¾“å…¥æ¡†
            const firstEmpty = container.querySelector('.letter-box:not([disabled])');
            if (firstEmpty) firstEmpty.focus();
        }

        function handleInput(e) {
            const input = e.target;
            input.value = input.value.toLowerCase();
            
            // è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€ä¸ª
            if (input.value) {
                const inputs = document.querySelectorAll('.letter-box:not([disabled])');
                const currentIndex = Array.from(inputs).indexOf(input);
                if (currentIndex < inputs.length - 1) {
                    inputs[currentIndex + 1].focus();
                }
            }
        }

        function handleKeydown(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                checkAnswer();
            } else if (e.key === 'Backspace' && !e.target.value) {
                // é€€æ ¼è·³åˆ°ä¸Šä¸€ä¸ª
                const inputs = document.querySelectorAll('.letter-box:not([disabled])');
                const currentIndex = Array.from(inputs).indexOf(e.target);
                if (currentIndex > 0) {
                    inputs[currentIndex - 1].focus();
                }
            }
        }

        function checkAnswer() {
            const word = currentWord.en;
            const inputs = document.querySelectorAll('.letter-box');
            
            let userAnswer = '';
            inputs.forEach(input => {
                userAnswer += input.value;
            });
            
            if (userAnswer.toLowerCase() === word.toLowerCase()) {
                // æ­£ç¡®
                correctCount++;
                document.getElementById('correct').textContent = correctCount;
                
                inputs.forEach(input => input.classList.add('correct'));
                
                if (attemptCount === 0) {
                    showMessage('âœ“ ç¬¬ä¸€æ¬¡å°±å°äº†ï¼å¤ªæ£’äº†ï¼', 'success');
                } else {
                    showMessage('âœ“ æ­£ç¢ºï¼ï¼ˆå˜—è©¦äº† ' + (attemptCount + 1) + ' æ¬¡ï¼‰', 'success');
                }
                
                setTimeout(() => {
                    currentWordIndex++;
                    nextWord();
                }, 1000);
            } else {
                // é”™è¯¯
                attemptCount++;
                inputs.forEach(input => input.classList.add('wrong'));
                
                if (attemptCount >= maxAttempts) {
                    // å·²è¾¾æœ€å¤§å°è¯•æ¬¡æ•°
                    wrongCount++;
                    document.getElementById('wrong').textContent = wrongCount;
                    showMessage('âŒ å·²å˜—è©¦ ' + maxAttempts + ' æ¬¡', 'error');
                    showAnswerButton();
                } else {
                    // è¿˜å¯ä»¥ç»§ç»­å°è¯•
                    showMessage('âŒ ä¸å°å“¦ï¼Œå†è©¦è©¦ï¼é‚„æœ‰ ' + (maxAttempts - attemptCount) + ' æ¬¡æ©Ÿæœƒ', 'error');
                    
                    // æ¸…é™¤çº¢è‰²é«˜äº®ï¼ˆä¸æ¸…ç©ºè¾“å…¥ï¼‰ï¼Œè®©ç”¨æˆ·ç»§ç»­ä¿®æ”¹
                    setTimeout(() => {
                        inputs.forEach(input => {
                            if (!input.classList.contains('hint') && !input.disabled) {
                                input.classList.remove('wrong');
                            }
                        });
                        // èšç„¦ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†
                        const firstInput = document.querySelector('.letter-box:not([disabled]):not(.hint)');
                        if (firstInput) firstInput.focus();
                    }, 600);
                }
            }
        }

        function showAnswerButton() {
            const actionArea = document.querySelector('.action-buttons');
            actionArea.innerHTML = `
                <button class="btn green" onclick="showCorrectAnswer()">ğŸ‘€ æŸ¥çœ‹ç­”æ¡ˆ</button>
                <button class="btn" onclick="tryAgain()" style="background:#f1f3f4;">ğŸ”„ å†è©¦ä¸€æ¬¡</button>
                <button class="btn blue" onclick="skipWord()">è·³é â†’</button>
            `;
        }

        function tryAgain() {
            // æ¢å¤æŒ‰é’®
            const actionArea = document.querySelector('.action-buttons');
            actionArea.innerHTML = `
                <button class="btn green" onclick="checkAnswer()">âœ“ ç¢ºèª</button>
                <button class="btn blue" onclick="skipWord()">è·³é â†’</button>
            `;
            
            // æ¸…é™¤çº¢è‰²é«˜äº®
            const inputs = document.querySelectorAll('.letter-box');
            inputs.forEach(input => {
                if (!input.classList.contains('hint') && !input.disabled) {
                    input.classList.remove('wrong');
                }
            });
            
            // é‡ç½®å°è¯•æ¬¡æ•°ï¼ˆç»™äºˆé¢å¤–æœºä¼šï¼‰
            attemptCount = maxAttempts - 1;
            document.getElementById('resultMessage').classList.remove('show');
            
            // èšç„¦
            const firstInput = document.querySelector('.letter-box:not([disabled]):not(.hint)');
            if (firstInput) firstInput.focus();
        }

        function showCorrectAnswer() {
            const word = currentWord.en;
            const inputs = document.querySelectorAll('.letter-box');
            
            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].value = word[i];
                inputs[i].classList.remove('wrong');
                inputs[i].classList.add('correct');
            }
            
            showMessage('ğŸ“ æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š' + word + 'ï¼Œè¨˜ä½å®ƒå“¦ï¼', 'error');
            
            setTimeout(() => {
                currentWordIndex++;
                nextWord();
            }, 2500);
        }

        function skipWord() {
            wrongCount++;
            document.getElementById('wrong').textContent = wrongCount;
            showMessage('â­ï¸ è·³éäº†', 'error');
            
            setTimeout(() => {
                currentWordIndex++;
                nextWord();
            }, 800);
        }

        function showMessage(text, type) {
            const msg = document.getElementById('resultMessage');
            msg.textContent = text;
            msg.className = 'result-message show ' + type;
        }

        function showCompletion() {
            gameActive = false;
            
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('completionScreen').classList.add('show');
            
            const total = correctCount + wrongCount;
            const accuracy = total > 0 ? Math.round(correctCount / total * 100) : 0;
            
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalWrong').textContent = wrongCount;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
        }

        // åˆå§‹åŒ–
        initCategoryBtns();
    </script>
</body>
</html>
